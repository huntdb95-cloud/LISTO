<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="image/png" href="/images/favicon.png"/>
  <link rel="shortcut icon" type="image/png" href="/images/favicon.png"/>
  <link rel="apple-touch-icon" href="/images/favicon.png"/>
  <title>Audit Help</title>

  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="../styles.css" />
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

  <style>
    /* Brand green color variable */
    :root {
      --audit-brand-green: var(--brand, #4DA763);
      --audit-brand-dark: var(--brand-dark, #2F8B4A);
      --audit-brand-light: var(--brand-light, rgba(77,167,99,0.08));
    }
    
    /* Minimal page-specific layout; relies on your styles.css */
    .page-wrap { max-width: 1100px; margin: 0 auto; padding: 24px; }
    .card { background: rgba(255,255,255,0.92); border-radius: 14px; padding: 18px; margin-bottom: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.08); }
    .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 12px; }
    .col-12 { grid-column: span 12; }
    .col-6 { grid-column: span 6; }
    .col-4 { grid-column: span 4; }
    .col-8 { grid-column: span 8; }
    @media (max-width: 900px) {
      .col-6,.col-4,.col-8 { grid-column: span 12; }
    }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px; border-bottom: 1px solid rgba(0,0,0,0.08); text-align: left; font-size: 14px; }
    .muted { opacity: 0.75; }
    .btn-row { display: flex; gap: 10px; flex-wrap: wrap; }
    .btn { cursor: pointer; border: none; border-radius: 10px; padding: 10px 14px; font-weight: 600; transition: all 0.2s; }
    .btn-primary { background: var(--audit-brand-green); color: #fff; }
    .btn-primary:hover { background: var(--audit-brand-dark); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(77,167,99,0.3); }
    .btn-secondary { background: #eee; color: #111; }
    .btn-secondary:hover { background: #ddd; }
    .pill { display:inline-block; padding:4px 10px; border-radius:999px; background:var(--audit-brand-light); color:var(--audit-brand-dark); font-size:12px; font-weight: 500; }
    .danger { color: #b00020; font-weight: 700; }
    input, select, textarea { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid rgba(0,0,0,0.14); box-sizing: border-box; }
    textarea { min-height: 90px; }
    .small { font-size: 12px; }
    
    /* Brand green accents for section headers (h2 only - main page title uses standard black) */
    body[data-page="audit"] h2 {
      color: var(--audit-brand-dark);
    }
    
    /* Main page title should match standard page-title styling (black, not green) */
    body[data-page="audit"] .page-title {
      color: var(--text) !important;
    }
    
    /* Section header borders with brand green */
    body[data-page="audit"] .audit-section-header {
      border-bottom: 2px solid var(--audit-brand-light);
      padding-bottom: 8px;
    }
    
    /* Active/expanded section indicator */
    body[data-page="audit"] .audit-section:not(.collapsed) .audit-section-header {
      border-bottom-color: var(--audit-brand-green);
    }
    
    /* Table header with brand green */
    body[data-page="audit"] table thead th {
      background: var(--audit-brand-light);
      color: var(--audit-brand-dark);
      font-weight: 600;
      border-bottom: 2px solid var(--audit-brand-green);
    }
    
    /* Collapsible sections */
    .audit-section-header { user-select: none; }
    .audit-section-toggle { font-size: 12px; transition: transform 0.2s; }
    .audit-section.collapsed .audit-section-toggle { transform: rotate(-90deg); }
    .audit-section.collapsed .audit-section-content { display: none; }
    .audit-section.collapsed .audit-section-header { margin-bottom: 0; }
    
    /* Mobile fixes for horizontal overflow */
    @media (max-width: 768px) {
      /* Prevent horizontal scrolling on audit page */
      body[data-page="audit"] {
        overflow-x: hidden;
        width: 100%;
        max-width: 100%;
      }
      
      body[data-page="audit"] .app-layout,
      body[data-page="audit"] main,
      body[data-page="audit"] .page-wrap {
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        overflow-x: hidden;
      }
      
      body[data-page="audit"] .page-wrap {
        padding: 16px;
      }
      
      /* Ensure all containers respect viewport width */
      body[data-page="audit"] .card {
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        padding: 16px;
      }
      
      /* Grid should be single column on mobile */
      body[data-page="audit"] .grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      /* Ensure grid columns don't overflow on mobile */
      body[data-page="audit"] .grid > * {
        min-width: 0;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      /* Ensure all form elements don't overflow */
      body[data-page="audit"] input,
      body[data-page="audit"] select,
      body[data-page="audit"] textarea,
      body[data-page="audit"] button {
        max-width: 100%;
        box-sizing: border-box;
      }
      
      /* Fix flex rows to prevent overflow */
      body[data-page="audit"] .btn-row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      body[data-page="audit"] .btn-row > * {
        min-width: 0;
        flex: 1 1 auto;
        max-width: 100%;
      }
      
      /* Ensure table doesn't overflow */
      body[data-page="audit"] table {
        width: 100%;
        max-width: 100%;
        table-layout: auto;
        box-sizing: border-box;
      }
      
      body[data-page="audit"] th,
      body[data-page="audit"] td {
        word-break: break-word;
        overflow-wrap: break-word;
      }
      
      /* Fix section headers to prevent overflow */
      body[data-page="audit"] .audit-section-header {
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        flex-wrap: wrap;
      }
    }
    
    /* States checkbox grid */
    .states-checkbox-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 8px;
      padding: 12px;
      border: 1px solid rgba(0,0,0,0.14);
      border-radius: 10px;
      background: #fff;
      max-height: 300px;
      overflow-y: auto;
    }
    .states-checkbox-grid label {
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      padding: 6px;
      border-radius: 4px;
      font-size: 14px;
    }
    .states-checkbox-grid label:hover {
      background: rgba(0,0,0,0.04);
    }
    .states-checkbox-grid input[type="checkbox"] {
      width: auto;
      margin: 0;
      cursor: pointer;
    }
    @media (max-width: 640px) {
      .states-checkbox-grid {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        max-height: 250px;
      }
    }
  </style>
</head>

<body data-page="audit" data-requires-auth="true">
<a class="skip-link" href="#main">Skip to content</a>
<header class="site-header">
<div class="container header-inner">
<div class="header-left">
<a href="../account/account.html" class="header-avatar" id="headerAvatar" title="My Account" aria-label="My Account" hidden>
<img id="headerAvatarImage" alt="Profile" style="display: none;" />
<span id="headerAvatarInitials" class="header-avatar-initials"></span>
</a>
</div>
<a aria-label="Listo Home" class="brand" href="../dashboard.html">
<img alt="Listo" class="brand-logo" src="../images/logo2.png"/>
</a>

<div class="header-actions">
</div>
</div>
</header>
<div class="app-layout">
  <div id="sidebar"></div>
  <main id="main">
  <section class="section">
    <div class="container">
      <div class="section-head">
        <h1 class="page-title" data-i18n="audit.title">Audit Help</h1>
        <p class="muted" data-i18n="audit.description">
          Learn about insurance audits and prepare your audit package with our step-by-step tool.
        </p>
      </div>
    </div>
  </section>
  <div class="page-wrap">

    <!-- Part 1: Audit Explanation -->
    <div class="card" style="margin-bottom: 32px;">
      <h2 style="margin-top:0; margin-bottom: 16px;" data-i18n="audit.explanationTitle">Audit Explanation</h2>
      
      <div style="margin-bottom: 20px;">
        <h3 style="margin-top:0; margin-bottom: 12px;" data-i18n="audit.whyTitle">Why do insurance audits exist?</h3>
        <p data-i18n="audit.whyDesc">
          Insurance audits are a standard practice where your insurance carrier verifies the information you provided when you purchased your policy. 
          Since workers' compensation premiums are based on your actual payroll, the carrier needs to confirm the amounts you paid during the policy period 
          to calculate your final premium accurately.
        </p>
      </div>

      <div style="margin-bottom: 20px;">
        <h3 style="margin-top:0; margin-bottom: 12px;" data-i18n="audit.expectationsTitle">What to expect</h3>
        <p data-i18n="audit.expectationsDesc">
          Your insurance carrier is verifying <b>payroll paid during your previous policy period</b> so your premium can be calculated correctly.
        </p>
        <p data-i18n="audit.expectationsSubDesc">
          During the audit, you'll typically need to provide:
        </p>
        <ul>
          <li data-i18n="audit.expectations1">Payroll amounts actually paid (by employee and totals)</li>
          <li data-i18n="audit.expectations2">Payment methods (check, cash, electronic)</li>
          <li data-i18n="audit.expectations3">Independent contractor payments (1099s) if applicable</li>
          <li data-i18n="audit.expectations4">Supporting bank statements and tax forms</li>
        </ul>
      </div>

      <div>
        <h3 style="margin-top:0; margin-bottom: 12px;" data-i18n="audit.processTitle">The audit process</h3>
        <p data-i18n="audit.processDesc">
          Most audits are straightforward. The auditor will review your payroll records, payment documentation, and any supporting materials you provide. 
          They may ask clarifying questions about your business operations, payment methods, or subcontractor relationships. 
          Being prepared with organized documentation makes the process smooth and helps ensure accurate premium calculations.
        </p>
        <p class="muted" style="margin-bottom:0;" data-i18n="audit.processNote">
          The Audit Packet tool below helps you organize all necessary documents and information before your audit, 
          compiling everything into a printer-friendly PDF package that you can email directly to your auditor.
        </p>
      </div>
    </div>

    <!-- Part 2: Audit Packet -->
    <div class="card" style="border-top: 3px solid var(--audit-brand-green); padding-top: 24px;">
      <h2 style="margin-top:0; margin-bottom: 16px;" data-i18n="audit.packetTitle">Audit Packet</h2>
      <div class="pill" data-i18n="audit.subtitle">Printer-friendly package ‚Ä¢ PDF 8.5√ó11 ‚Ä¢ SendGrid email</div>
      <p class="muted" style="margin-bottom: 20px;" data-i18n="audit.packetDesc">
        Use this tool to prepare your audit package by collecting your payroll summary (for your prior policy period),
        supporting documents, and a short questionnaire.
      </p>

      <!-- Business Information (Collapsible) -->
      <div class="card audit-section" style="margin-top: 20px;" id="businessInfoSection">
        <div class="audit-section-header" style="display: flex; justify-content: space-between; align-items: center; cursor: pointer; margin-bottom: 16px;">
          <div>
            <h2 style="margin:0;" data-i18n="audit.businessTitle">1) Business information</h2>
            <div id="businessInfoSummary" class="small muted" style="display: none; margin-top: 4px;"></div>
          </div>
          <div style="display: flex; align-items: center; gap: 12px;">
            <button id="businessInfoEditBtn" class="btn btn-secondary" type="button" style="display: none;">Edit</button>
            <span class="audit-section-toggle" id="businessInfoToggle">‚ñº</span>
          </div>
        </div>
        
        <div class="audit-section-content" id="businessInfoContent">
          <div class="grid">
            <!-- Autofilled fields (read-only display) -->
            <div class="col-6">
              <label>Business Name</label>
              <input id="businessName" type="text" readonly style="background: #f5f5f5;" />
            </div>
            <div class="col-6">
              <label>Email</label>
              <input id="businessEmail" type="email" readonly style="background: #f5f5f5;" />
            </div>
            <div class="col-6">
              <label>Phone</label>
              <input id="phone" type="text" readonly style="background: #f5f5f5;" />
            </div>
            <div class="col-6">
              <label>Tax ID (TIN/EIN/SSN)</label>
              <input id="taxId" type="text" readonly style="background: #f5f5f5;" />
            </div>
            <div class="col-6">
              <label>Street Address</label>
              <input id="businessAddress" type="text" readonly style="background: #f5f5f5;" />
            </div>
            <div class="col-4">
              <label>City</label>
              <input id="businessCity" type="text" readonly style="background: #f5f5f5;" />
            </div>
            <div class="col-2">
              <label>State</label>
              <input id="businessState" type="text" readonly style="background: #f5f5f5;" />
            </div>
            <div class="col-4">
              <label>ZIP Code</label>
              <input id="businessZip" type="text" readonly style="background: #f5f5f5;" />
            </div>
            
            <!-- Editable policy fields -->
            <div class="col-12" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(0,0,0,0.1);">
              <h3 style="margin:0 0 12px 0; font-size: 1.1rem; color: var(--audit-brand-dark);">Policy Information</h3>
            </div>
            <div class="col-4" style="min-width: 0;">
              <label data-i18n="audit.policyStart">Policy Start Date *</label>
              <input id="policyStart" type="date" required style="width: 100%; min-width: 0; box-sizing: border-box;" />
            </div>
            <div class="col-4" style="min-width: 0;">
              <label data-i18n="audit.policyEnd">Policy End Date *</label>
              <input id="policyEnd" type="date" required style="width: 100%; min-width: 0; box-sizing: border-box;" />
            </div>
            <div class="col-4" style="min-width: 0;">
              <label data-i18n="audit.policyNumber">Policy Number *</label>
              <input id="policyNumber" type="text" placeholder="POL-123456" required style="width: 100%; min-width: 0; box-sizing: border-box;" />
            </div>
            <div class="col-6" style="min-width: 0;">
              <label data-i18n="audit.auditorEmail">Auditor Email</label>
              <input id="auditorEmail" type="email" placeholder="agent@agency.com" style="width: 100%; min-width: 0; box-sizing: border-box;" />
            </div>
          </div>
          
          <div class="btn-row" style="margin-top: 16px;">
            <button id="btnSaveBusinessInfo" class="btn btn-primary" type="button">Save Business Information</button>
            <span id="businessInfoMsg" class="small muted"></span>
          </div>
          <div id="businessInfoError" class="small danger" style="margin-top: 8px;"></div>
        </div>
      </div>

      <!-- Questionnaire (Collapsible) -->
      <div class="card audit-section" style="margin-top: 20px;" id="questionnaireSection">
        <div class="audit-section-header" style="display: flex; justify-content: space-between; align-items: center; cursor: pointer; margin-bottom: 16px;">
          <div>
            <h2 style="margin:0;" data-i18n="audit.questionnaireTitle">2) Audit questionnaire</h2>
            <div id="questionnaireSummary" class="small muted" style="display: none; margin-top: 4px;"></div>
          </div>
          <div style="display: flex; align-items: center; gap: 12px;">
            <button id="questionnaireEditBtn" class="btn btn-secondary" type="button" style="display: none;">Edit</button>
            <span class="audit-section-toggle" id="questionnaireToggle">‚ñº</span>
          </div>
        </div>
        
        <div class="audit-section-content" id="questionnaireContent">
          <p class="muted" style="margin-bottom: 12px;" data-i18n="audit.questionnaireDesc">Answer these questions to help complete your audit package.</p>
          
          <div class="grid">
            <div class="col-12">
              <label>Type of work performed during the policy period *</label>
              <textarea id="qWorkType" required placeholder="Describe the types of work you performed (e.g., construction, remodeling, painting, etc.)"></textarea>
            </div>

            <div class="col-12">
              <label>Did you use subcontractors with their own insurance during the policy period? *</label>
              <select id="qSubcontractors" required>
                <option value="">Select</option>
                <option value="no">No</option>
                <option value="yes">Yes</option>
              </select>
            </div>

            <!-- Conditional COI upload (shown when Yes) -->
            <div class="col-12" id="coiUploadSection" style="display: none;">
              <label>Subcontractors' Certificates of Insurance (COI)</label>
              <input id="coiFiles" type="file" multiple accept=".pdf,.png,.jpg,.jpeg" />
              <div class="small muted" style="margin-top: 4px;">You can upload multiple COI files</div>
              <div id="coiUploadedList" style="margin-top: 12px;"></div>
            </div>

            <div class="col-12">
              <label>Which states did you work in during the policy period? *</label>
              <div id="statesCheckboxGrid" class="states-checkbox-grid" style="margin-top: 8px;">
                <!-- Will be populated by JS -->
              </div>
            </div>
          </div>

          <div class="btn-row" style="margin-top: 16px;">
            <button id="btnSaveQuestionnaire" class="btn btn-primary" type="button" data-i18n="audit.saveQuestionnaire">Save Questionnaire</button>
            <span id="qMsg" class="small muted"></span>
          </div>
          <div id="questionnaireError" class="small danger" style="margin-top: 8px;"></div>
        </div>
      </div>

      <!-- Payroll Summary (Collapsible) -->
      <div class="card audit-section" style="margin-top: 20px;" id="payrollSection">
        <div class="audit-section-header" style="display: flex; justify-content: space-between; align-items: center; cursor: pointer; margin-bottom: 12px;">
          <div>
            <h2 style="margin:0;" data-i18n="audit.payrollTitle">3) Payroll summary</h2>
            <div id="payrollSummary" class="small muted" style="display: none; margin-top: 4px;"></div>
          </div>
          <div style="display: flex; align-items: center; gap: 12px;">
            <button id="btnLoadPayroll" class="btn btn-secondary" type="button" data-i18n="audit.loadPayroll">Load payroll summary</button>
            <span class="audit-section-toggle" id="payrollToggle">‚ñº</span>
          </div>
        </div>
        
        <div class="audit-section-content" id="payrollContent">
          <p class="muted" style="margin-bottom: 12px;" data-i18n="audit.payrollDesc">Summary of payroll entries for the audit period</p>
          <div id="payrollStatus" class="small muted" style="margin-bottom: 10px;"></div>

          <div style="overflow:auto; margin-top: 10px;">
            <table id="payrollTable" aria-label="Payroll summary table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Method</th>
                  <th data-i18n="audit.tableTotalPaid">Total Paid</th>
                </tr>
              </thead>
              <tbody></tbody>
              <tfoot>
                <tr>
                  <td colspan="2"><b data-i18n="audit.tableGrandTotal">Grand Total</b></td>
                  <td id="grandTotal"><b>$0.00</b></td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      </div>

      <!-- Document Uploads (Collapsible) -->
      <div class="card audit-section" style="margin-top: 20px;" id="uploadSection">
        <div class="audit-section-header" style="display: flex; justify-content: space-between; align-items: center; cursor: pointer; margin-bottom: 16px;">
          <div>
            <h2 style="margin:0;" data-i18n="audit.uploadTitle">4) Upload supporting documents</h2>
            <div id="uploadSummary" class="small muted" style="display: none; margin-top: 4px;"></div>
          </div>
          <span class="audit-section-toggle" id="uploadToggle">‚ñº</span>
        </div>
        
        <div class="audit-section-content" id="uploadContent">
      <p class="muted" data-i18n="audit.uploadDesc" style="margin-bottom: 16px;">Upload documents like Schedule C, bank statements, payroll summaries, or other supporting documents.</p>

      <div class="grid">
        <div class="col-6">
          <label>Bank statements (multiple files allowed)</label>
          <input id="bankStatements" type="file" multiple accept=".pdf,.png,.jpg,.jpeg" />
          <div class="small muted">Tip: You can upload one file per month.</div>
        </div>

        <div class="col-6">
          <label>Schedule C</label>
          <input id="scheduleC" type="file" accept=".pdf,.png,.jpg,.jpeg" />
        </div>

        <div class="col-6">
          <label>1096 (if applicable)</label>
          <input id="form1096" type="file" accept=".pdf,.png,.jpg,.jpeg" />
        </div>

        <div class="col-6">
          <label>1099s (multiple files allowed, if applicable)</label>
          <input id="form1099" type="file" multiple accept=".pdf,.png,.jpg,.jpeg" />
        </div>

        <div class="col-12">
          <div class="btn-row">
            <button id="btnUploadDocs" class="btn btn-secondary" type="button" data-i18n="audit.uploadBtn">Upload Document</button>
            <span id="uploadMsg" class="small muted"></span>
          </div>
        </div>
      </div>

      <div style="margin-top:12px;">
        <h3 style="margin: 10px 0 6px;" data-i18n="audit.uploadedTitle">Uploaded Documents</h3>
        <div id="uploadedList" class="small"></div>
      </div>
        </div>
      </div>

      <!-- Final: Download + Email -->
      <div class="card" style="margin-top: 20px;">
      <h2 style="margin-top:0;" data-i18n="audit.downloadTitle">5) Download a Copy or Email Packet</h2>
      <p class="muted" data-i18n="audit.generateDesc">
        This generates a printer-friendly PDF and sends it (plus uploaded documents) via SendGrid.
      </p>

      <div class="btn-row">
        <button id="btnGeneratePdf" class="btn btn-secondary" type="button" data-i18n="audit.downloadPacket">Download Packet</button>
        <button id="btnEmailPackage" class="btn btn-primary" type="button" data-i18n="audit.emailPackage">Email audit package</button>
      </div>

      <div id="finalMsg" class="small muted" style="margin-top:10px;"></div>
      <div id="finalErr" class="small danger" style="margin-top:10px;"></div>
      </div>
    </div>

  </div>
<!-- Footer -->
<footer class="site-footer">
  <img class="footer-logo" src="../images/logo.png" alt="Listo" />
  <div class="footer-text">Built to help contractors focus on their work by automating the business side of things.</div>
  <div class="footer-copyright">¬© Listo Co LLC</div>
</footer>
  </main>
</div>

<!-- Mobile Bottom Navigation -->
<nav class="mobile-bottom-nav" aria-label="Mobile navigation">
  <div class="mobile-bottom-nav-items">
    <a href="../dashboard.html" class="mobile-bottom-nav-item" data-nav="home">
      <div class="mobile-bottom-nav-icon">üè†</div>
      <div class="mobile-bottom-nav-label" data-i18n="nav.dashboard">Home</div>
    </a>
    <a href="../contracts/contracts.html" class="mobile-bottom-nav-item" data-nav="contracts">
      <div class="mobile-bottom-nav-icon">üìÑ</div>
      <div class="mobile-bottom-nav-label" data-i18n="nav.contracts">Contracts</div>
    </a>
    <a href="../bookkeeping/bookkeeping.html" class="mobile-bottom-nav-item" data-nav="bookkeeping">
      <div class="mobile-bottom-nav-icon">üìä</div>
      <div class="mobile-bottom-nav-label" data-i18n="nav.bookkeeping">Bookkeeping</div>
    </a>
    <a href="../tools/tools.html" class="mobile-bottom-nav-item active" data-nav="tools">
      <div class="mobile-bottom-nav-icon">üîß</div>
      <div class="mobile-bottom-nav-label" data-i18n="nav.tools">Tools</div>
    </a>
    <a href="../settings/settings.html" class="mobile-bottom-nav-item" data-nav="settings">
      <div class="mobile-bottom-nav-icon">‚öôÔ∏è</div>
      <div class="mobile-bottom-nav-label" data-i18n="nav.settings">Settings</div>
    </a>
  </div>
</nav>

<script src="../sidebar.js"></script>
<script src="../scripts.js" type="module"></script>
<script type="module" src="./audit.js"></script>
</body>
</html>

