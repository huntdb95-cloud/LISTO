<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Invoice Builder</title>

  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet"/>
  <!-- Your existing site styles -->
  <link rel="stylesheet" href="../styles.css" />

  <!-- jsPDF + AutoTable (PDF export on client) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

  <style>
    /* Invoice page scoped styles */
    .invoice-page-wrap { max-width: 1100px; margin: 0 auto; padding: 18px; }
    .invoice-card { background: rgba(255,255,255,.92); border: 1px solid rgba(0,0,0,.08); border-radius: 12px; padding: 16px; }
    .invoice-grid { display: grid; gap: 12px; }
    .invoice-grid-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .invoice-grid-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    .invoice-row { display:flex; gap: 10px; align-items:center; flex-wrap: wrap; }
    .invoice-label { display:block; font-size: 0.9rem; opacity: .85; margin-bottom: 6px; }
    .invoice-input, .invoice-textarea, .invoice-select { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid rgba(0,0,0,.15); background: #fff; box-sizing: border-box; }
    .invoice-textarea { min-height: 90px; resize: vertical; }
    
    /* Line Items Table - Desktop */
    .invoice-items-table-wrapper { overflow-x: auto; }
    .invoice-items-table { width:100%; border-collapse: collapse; }
    .invoice-items-table th, .invoice-items-table td { border-bottom: 1px solid rgba(0,0,0,.1); padding: 12px 10px; vertical-align: top; }
    .invoice-items-table th { text-align:left; font-size: .9rem; opacity: .8; font-weight: 600; background: rgba(0,0,0,.02); }
    .invoice-items-table td input { width: 100%; padding: 8px 10px; border: 1px solid rgba(0,0,0,.15); border-radius: 6px; box-sizing: border-box; font-size: 0.95rem; }
    .invoice-num { text-align: right; white-space: nowrap; }
    
    /* Line Items Cards - Mobile */
    .invoice-items-cards { display: none; }
    .invoice-item-card { background: #fff; border: 1px solid rgba(0,0,0,.1); border-radius: 10px; padding: 16px; margin-bottom: 12px; }
    .invoice-item-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; gap: 12px; }
    .invoice-item-card-desc { flex: 1; min-width: 0; }
    .invoice-item-card-desc input { width: 100%; padding: 10px 12px; border: 1px solid rgba(0,0,0,.15); border-radius: 6px; font-size: 0.95rem; box-sizing: border-box; }
    .invoice-item-card-remove { flex-shrink: 0; }
    .invoice-item-card-fields { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }
    .invoice-item-card-field { display: flex; flex-direction: column; gap: 6px; }
    .invoice-item-card-field label { font-size: 0.85rem; opacity: .7; font-weight: 500; }
    .invoice-item-card-field input { width: 100%; padding: 10px 12px; border: 1px solid rgba(0,0,0,.15); border-radius: 6px; font-size: 0.95rem; box-sizing: border-box; }
    .invoice-item-card-total { border-top: 2px solid rgba(0,0,0,.1); padding-top: 12px; margin-top: 8px; display: flex; justify-content: space-between; align-items: center; }
    .invoice-item-card-total-label { font-weight: 600; font-size: 0.95rem; }
    .invoice-item-card-total-value { font-weight: 700; font-size: 1.1rem; color: #111827; }
    
    .invoice-btn {
      border: 0; border-radius: 10px; padding: 10px 14px; cursor: pointer;
      background: #111827; color: #fff; font-weight: 600; font-size: 0.95rem;
      transition: background 0.2s ease;
    }
    .invoice-btn:hover:not(:disabled) { background: #374151; }
    .invoice-btn.secondary, 
    .invoice-card .btn.secondary { background: #374151; }
    .invoice-btn.secondary:hover:not(:disabled),
    .invoice-card .btn.secondary:hover:not(:disabled) { background: #4b5563; }
    .invoice-btn.ghost,
    .invoice-card .btn.ghost { background: transparent; color: #111827; border: 1px solid rgba(0,0,0,.15); }
    .invoice-btn.ghost:hover:not(:disabled),
    .invoice-card .btn.ghost:hover:not(:disabled) { background: rgba(0,0,0,.05); }
    .invoice-btn.danger,
    .invoice-card .btn.danger,
    #itemsTable .invoice-btn.danger { background: #b91c1c; color: #fff; }
    .invoice-btn.danger:hover:not(:disabled),
    .invoice-card .btn.danger:hover:not(:disabled),
    #itemsTable .invoice-btn.danger:hover:not(:disabled) { background: #991b1b; }
    .invoice-btn:disabled { opacity: .6; cursor: not-allowed; }
    .invoice-muted { opacity:.8; font-size:.92rem; }
    
    /* Totals Section */
    .invoice-totals-wrapper { display: flex; flex-wrap: wrap; gap: 24px; margin-top: 16px; }
    .invoice-adjustments { flex: 1; min-width: 280px; }
    .invoice-totals { flex: 0 0 auto; min-width: 280px; max-width: 100%; }
    .invoice-totals .line { display:flex; justify-content: space-between; padding: 8px 0; font-size: 0.95rem; }
    .invoice-totals .grand { font-weight: 800; font-size: 1.2rem; border-top: 2px solid rgba(0,0,0,.15); padding-top: 12px; margin-top: 8px; }
    .invoice-topbar { display:flex; justify-content: space-between; align-items: flex-start; gap: 12px; flex-wrap: wrap; }
    .invoice-topbar-actions { display: flex; gap: 8px; flex-wrap: wrap; }
    .invoice-pill { display:inline-block; padding: 6px 10px; border-radius: 999px; background: rgba(17,24,39,.08); font-size: 0.9rem; }
    .invoice-pill.ok { background: rgba(16,185,129,.14); color: #059669; }
    .invoice-pill.warn { background: rgba(245,158,11,.18); color: #d97706; }
    .invoice-pill.err { background: rgba(239,68,68,.18); color: #dc2626; }
    
    /* Responsive Breakpoints */
    @media (max-width: 860px){
      .invoice-grid-2, .invoice-grid-3 { grid-template-columns: 1fr; }
      .invoice-topbar { flex-direction: column; }
      .invoice-topbar-actions { width: 100%; }
      .invoice-topbar-actions .invoice-btn { flex: 1; min-width: 120px; }
      .invoice-totals-wrapper { flex-direction: column; }
      .invoice-adjustments, .invoice-totals { width: 100%; max-width: 100%; }
      
      /* Hide table, show cards on mobile */
      .invoice-items-table-wrapper { display: none; }
      .invoice-items-cards { display: block; }
    }
    
    @media (min-width: 861px) {
      .invoice-items-cards { display: none; }
      .invoice-items-table-wrapper { display: block; }
    }
    
    @media (max-width: 640px) {
      .invoice-page-wrap { padding: 12px; }
      .invoice-card { padding: 12px; }
      .invoice-item-card-fields { grid-template-columns: 1fr; }
      .invoice-topbar-actions { flex-direction: column; }
      .invoice-topbar-actions .invoice-btn { width: 100%; }
    }
  </style>
</head>

<body data-page="invoice" data-requires-auth="true">
<a class="skip-link" href="#main">Skip to content</a>
<header class="site-header">
<div class="container header-inner">
<div class="header-left">
<a href="../account/account.html" class="header-avatar" id="headerAvatar" title="My Account" aria-label="My Account" hidden>
<img id="headerAvatarImage" alt="Profile" style="display: none;" />
<span id="headerAvatarInitials" class="header-avatar-initials"></span>
</a>
</div>
<a aria-label="Listo Home" class="brand" href="../dashboard.html">
<img alt="Listo" class="brand-logo" src="../images/logo2.png"/>
</a>

<div class="header-actions">
</div>
</div>
</header>
<div class="app-layout">
  <div id="sidebar"></div>
  <main id="main">
  <div class="page-wrap invoice-page-wrap">
    <div class="invoice-topbar">
      <div>
        <h1 style="margin:0 0 6px 0;" data-i18n="invoice.title">Invoice Builder</h1>
        <div class="invoice-muted" data-i18n="invoice.pageDescription">Create, save, export, and send invoices (PDF attached via SendGrid).</div>
      </div>

      <div class="invoice-topbar-actions">
        <button class="invoice-btn ghost" id="btnNew" data-i18n="invoice.new">New</button>
        <button class="invoice-btn secondary" id="btnSave" data-i18n="invoice.save">Save</button>
        <button class="invoice-btn" id="btnPdf" data-i18n="invoice.downloadPdf">Download PDF</button>
        <button class="invoice-btn" id="btnSendEmail" data-i18n="invoice.sendEmail">Send Invoice</button>
      </div>
    </div>

    <div style="height:12px;"></div>

    <div class="card invoice-card invoice-grid invoice-grid-2" style="background: rgba(255,255,255,.92); border: 1px solid rgba(0,0,0,.08); border-radius: 12px; padding: 16px;">
      <div>
        <h3 style="margin:0 0 10px 0;" data-i18n="invoice.yourCompany">Your Company</h3>
        <div class="invoice-grid">
          <div>
            <label class="invoice-label" data-i18n="invoice.companyName">Company / Contractor Name</label>
            <input class="invoice-input" id="fromName" placeholder="ABC Construction LLC" />
          </div>
          <div>
            <label class="invoice-label" data-i18n="invoice.replyEmail">Email (Reply-To)</label>
            <input class="invoice-input" id="fromEmail" type="email" placeholder="billing@yourcompany.com" />
          </div>
          <div>
            <label class="invoice-label" data-i18n="invoice.phone">Phone</label>
            <input class="invoice-input" id="fromPhone" type="tel" placeholder="(555) 555-5555" />
          </div>
          <div>
            <label class="invoice-label" data-i18n="invoice.address">Address</label>
            <textarea class="invoice-textarea" id="fromAddress" placeholder="Street&#10;City, State ZIP"></textarea>
          </div>
        </div>
      </div>

      <div>
        <h3 style="margin:0 0 10px 0;" data-i18n="invoice.customer">Customer</h3>
        <div class="invoice-grid">
          <div style="grid-column: 1 / -1;">
            <label class="invoice-label" data-i18n="invoice.selectBuilder">Select Builder (Optional)</label>
            <select class="invoice-select" id="selectBuilder" style="margin-bottom: 8px;">
              <option value="">‚Äî Select a builder ‚Äî</option>
            </select>
            <select class="invoice-select" id="selectJob" style="display: none;">
              <option value="">‚Äî Select a job (optional) ‚Äî</option>
            </select>
          </div>
          <div>
            <label class="invoice-label" data-i18n="invoice.customerName">Customer Name</label>
            <input class="invoice-input" id="toName" placeholder="Customer Name" />
          </div>
          <div>
            <label class="invoice-label" data-i18n="invoice.customerEmail">Customer Email</label>
            <input class="invoice-input" id="toEmail" type="email" placeholder="customer@email.com" />
          </div>
          <div>
            <label class="invoice-label" data-i18n="invoice.customerPhone">Customer Phone</label>
            <input class="invoice-input" id="toPhone" type="tel" placeholder="(555) 555-5555" />
          </div>
          <div>
            <label class="invoice-label" data-i18n="invoice.customerAddress">Customer Address</label>
            <textarea class="invoice-textarea" id="toAddress" placeholder="Street&#10;City, State ZIP"></textarea>
          </div>
        </div>
      </div>
    </div>

    <div style="height:12px;"></div>

    <div class="card invoice-card invoice-grid invoice-grid-3" style="background: rgba(255,255,255,.92); border: 1px solid rgba(0,0,0,.08); border-radius: 12px; padding: 16px;">
      <div>
        <label class="invoice-label" data-i18n="invoice.invoiceNumber">Invoice #</label>
        <input class="invoice-input" id="invoiceNumber" placeholder="INV-1001" />
      </div>
      <div>
        <label class="invoice-label" data-i18n="invoice.invoiceDate">Invoice Date</label>
        <input class="invoice-input" id="invoiceDate" type="date" />
      </div>
      <div>
        <label class="invoice-label" data-i18n="invoice.dueDate">Due Date</label>
        <input class="invoice-input" id="dueDate" type="date" />
      </div>

      <div class="invoice-grid" style="grid-column: 1 / -1;">
        <div>
          <label class="invoice-label" data-i18n="invoice.projectName">Project / Description</label>
          <input class="invoice-input" id="projectName" placeholder="Kitchen remodel - phase 1" />
        </div>
      </div>
    </div>

    <div style="height:12px;"></div>

    <div class="card invoice-card" style="background: rgba(255,255,255,.92); border: 1px solid rgba(0,0,0,.08); border-radius: 12px; padding: 16px;">
      <div class="invoice-row" style="justify-content: space-between; margin-bottom: 16px;">
        <h3 style="margin:0;" data-i18n="invoice.lineItems">Line Items</h3>
        <button class="invoice-btn ghost" id="btnAddItem" data-i18n="invoice.addItem">+ Add Item</button>
      </div>

      <!-- Desktop Table View -->
      <div class="invoice-items-table-wrapper">
        <table id="itemsTable" class="invoice-items-table">
          <thead>
            <tr>
              <th style="min-width:260px;" data-i18n="invoice.description">Description</th>
              <th style="width:90px;" class="invoice-num" data-i18n="invoice.quantity">Qty</th>
              <th style="width:140px;" class="invoice-num" data-i18n="invoice.unitPrice">Unit Price</th>
              <th style="width:140px;" class="invoice-num" data-i18n="invoice.lineTotal">Line Total</th>
              <th style="width:90px;"></th>
            </tr>
          </thead>
          <tbody id="itemsBody"></tbody>
        </table>
      </div>

      <!-- Mobile Card View -->
      <div class="invoice-items-cards" id="itemsCards"></div>

      <div style="height:14px;"></div>

      <div class="invoice-totals-wrapper">
        <div class="invoice-adjustments invoice-grid invoice-grid-3">
          <div>
            <label class="invoice-label" data-i18n="invoice.taxRate">Tax %</label>
            <input class="invoice-input" id="taxRate" type="number" step="0.01" min="0" placeholder="0" />
          </div>
          <div>
            <label class="invoice-label" data-i18n="invoice.discount">Discount ($)</label>
            <input class="invoice-input" id="discount" type="number" step="0.01" min="0" placeholder="0" />
          </div>
          <div>
            <label class="invoice-label" data-i18n="invoice.deposit">Deposit Paid ($)</label>
            <input class="invoice-input" id="deposit" type="number" step="0.01" min="0" placeholder="0" />
          </div>
        </div>

        <div class="invoice-totals">
          <div class="line"><span data-i18n="invoice.subtotal">Subtotal</span><span id="subtotalOut">$0.00</span></div>
          <div class="line"><span data-i18n="invoice.tax">Tax</span><span id="taxOut">$0.00</span></div>
          <div class="line"><span data-i18n="invoice.discountLabel">Discount</span><span id="discountOut">$0.00</span></div>
          <div class="line"><span data-i18n="invoice.depositLabel">Deposit</span><span id="depositOut">$0.00</span></div>
          <div class="line grand"><span data-i18n="invoice.totalDue">Total Due</span><span id="totalOut">$0.00</span></div>

          <div style="margin-top:12px;">
            <span class="invoice-pill" id="statusPill">Not saved</span>
          </div>

          <div style="margin-top:8px;" class="invoice-muted" id="sendResult"></div>
        </div>
      </div>

      <div style="height:12px;"></div>

      <div class="invoice-grid invoice-grid-2">
        <div>
          <label class="invoice-label" data-i18n="invoice.notes">Notes</label>
          <textarea class="invoice-textarea" id="notes" placeholder="Thank you for your business."></textarea>
        </div>
        <div>
          <label class="invoice-label" data-i18n="invoice.paymentInstructions">Payment Instructions</label>
          <textarea class="invoice-textarea" id="paymentInstructions" placeholder="Zelle: your@email.com&#10;Check payable to: ..."></textarea>
        </div>
      </div>

      <div style="height:12px;"></div>

      <div>
        <label class="invoice-label" data-i18n="invoice.recentInvoices">Recent Saved Invoices</label>
        <div class="invoice-row" style="flex-wrap: wrap; gap: 8px;">
          <select class="invoice-select" id="savedInvoicesSelect" style="flex: 1; min-width: 200px;">
            <option value="">‚Äî Load a saved invoice ‚Äî</option>
          </select>
          <button class="invoice-btn ghost" id="btnLoad" data-i18n="invoice.loadInvoice">Load</button>
          <button class="invoice-btn danger" id="btnDelete" data-i18n="invoice.deleteInvoice">Delete</button>
        </div>
        <div class="invoice-muted" style="margin-top:8px;" data-i18n="invoice.sendNote">
          "Send Invoice" emails a PDF attachment through your Firebase backend + SendGrid.
        </div>
      </div>
    </div>
  </div>
  </main>
</div>

<!-- Mobile Bottom Navigation -->
<nav class="mobile-bottom-nav" aria-label="Mobile navigation">
  <div class="mobile-bottom-nav-items">
    <a href="../dashboard.html" class="mobile-bottom-nav-item" data-nav="home">
      <div class="mobile-bottom-nav-icon">üè†</div>
      <div class="mobile-bottom-nav-label" data-i18n="nav.dashboard">Home</div>
    </a>
    <a href="../contracts/contracts.html" class="mobile-bottom-nav-item" data-nav="contracts">
      <div class="mobile-bottom-nav-icon">üìÑ</div>
      <div class="mobile-bottom-nav-label" data-i18n="nav.contracts">Contracts</div>
    </a>
    <a href="../bookkeeping/bookkeeping.html" class="mobile-bottom-nav-item" data-nav="bookkeeping">
      <div class="mobile-bottom-nav-icon">üìä</div>
      <div class="mobile-bottom-nav-label" data-i18n="nav.bookkeeping">Bookkeeping</div>
    </a>
    <a href="../tools/tools.html" class="mobile-bottom-nav-item active" data-nav="tools">
      <div class="mobile-bottom-nav-icon">üîß</div>
      <div class="mobile-bottom-nav-label" data-i18n="nav.tools">Tools</div>
    </a>
    <a href="../settings/settings.html" class="mobile-bottom-nav-item" data-nav="settings">
      <div class="mobile-bottom-nav-icon">‚öôÔ∏è</div>
      <div class="mobile-bottom-nav-label" data-i18n="nav.settings">Settings</div>
    </a>
  </div>
</nav>

<script src="../sidebar.js"></script>
<script src="../scripts.js" type="module"></script>
<script type="module" src="./invoice.js"></script>
</body>
</html>

